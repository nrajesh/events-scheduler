<!DOCTYPE html>
<html>
<head>
    <title>Events Scheduler</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <script src="/webjars/sockjs-client/sockjs.min.js"></script>
    <script src="/webjars/stomp-websocket/stomp.min.js"></script>
    <script type="text/javascript" src="webjars/jquery/jquery.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
  <script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
    <script src="/scheduler.js"></script>

    <style id="compiled-css" type="text/css">
        label {
            display: block;
        }

        .vl {
            border-left: 2px solid gray;
            margin-left: 50px;
            height: 300px;
        }
    </style>
</head>
<body onload="fnConnect();">
    <center>
    <table>
        <tr>
            <th>Single Entry</th>
            <th>&nbsp;</th>
            <th>Multiple Entry</th>
        </tr>
        <tr><td colspan="3">&nbsp;</td></tr>
        <tr>
            <td>
                <!--form method="GET"-->
                    <div>
                        <b>Event Name*</b>&nbsp;&nbsp;&nbsp;<input type="text" id="eventName" name="eventName" style="width:150px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                        <br>
                        <br>
                        <label><b>Start Date*</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input name="startDate" id="startDate" data-date-autoclose="true" type="date" required onchange="if(this.value){document.getElementById('endDate').min = this.value}" useCurrent></label>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <label><b>End Date</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input name="endDate" id="endDate" type="date" onchange="if(this.value){document.getElementById('startDate').max = this.value;} if(null!=this.value) document.getElementById('recurNum').disabled=true; if(''==this.value) document.getElementById('recurNum').disabled=false;"></label>
                        <br>
                        <Center><b>OR</b></Center>
                        <br>
                        <b>Stop after</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input id="recurNum" min="1" type="number" value="1" style="width: 40px;" onchange="if(null!=this.value) document.getElementById('endDate').disabled=true; document.getElementById('endDate').value=''">&nbsp;times

                        <br>
                        <br>
                        <b>Recur Every</b>&nbsp;&nbsp;&nbsp;&nbsp;<input id="recurFreq" min="1" type="number" value="1" style="width: 38px;">&nbsp;
                        <select id="recurPattern" onchange="showNxtPattern();">
                            <option id="0" value="d">Day(s)</option>
                            <option id="1" value="w">Week(s)</option>
                            <option id="2" value="m">Month(s)</option>
                            <option id="4" value="y">Year(s)</option>
                        </select>&nbsp;&nbsp;&nbsp;

                        <div id="dummy" style="visibility:collapse"></div>
                        
                        <div id="repeatPattern" style="visibility:collapse">
                        <br>
                        <b>Starting from</b>&nbsp;&nbsp;
                        <select multiple id="weekPattern" hidden>
                            <option id="16" value="1" default>Sunday</option>
                            <option id="10" value="2">Monday</option>
                            <option id="11" value="3">Tuesday</option>
                            <option id="12" value="4">Wednesday</option>
                            <option id="13" value="5">Thursday</option>
                            <option id="14" value="6">Friday</option>
                            <option id="15" value="7">Saturday</option>
                        </select>
                        <select id="monthPattern" hidden>
                            <option id="200" value="0" default>January</option>
                            <option id="201" value="1">February</option>
                            <option id="202" value="2">March</option>
                            <option id="203" value="3">April</option>
                            <option id="204" value="4">May</option>
                            <option id="205" value="5">June</option>
                            <option id="206" value="6">July</option>
                            <option id="207" value="7">August</option>
                            <option id="208" value="8">September</option>
                            <option id="209" value="9">October</option>
                            <option id="210" value="10">November</option>
                            <option id="211" value="11">December</option>
                        </select>

                        <br>
                        <br>
                        </div>
                        
                        <br>
                        <br>
                        <center><input id="saveSingleEvent" type="submit" style="width:100px" value="SUBMIT"></center>
                    </div>
                <!--/form-->
            </td>
            <td>
                <div class="vl">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            </td>
            <td>
                <textarea id="multiEvents" style="height:200px;width:550px;text-align:left">{"eventName":"Holiday","startDate":"2019-03-17","endDate":"2019-03-19","recurNum":"2","recurPattern":"w","weekPattern":"7,1","monthPattern":"","recurFreq":"2"}
{"eventName":"Bonus","startDate":"2019-03-18","endDate":"","recurNum":"1","recurPattern":"m","weekPattern":"","monthPattern":"0","recurFreq":"1"}</textarea>
            
                <br>
                <br>
                <center><input id="saveMultipleEvent" type="submit" style="width:100px" value="MULTI SUBMIT"></center>
            </td>
        </tr>
        <tr>
            <td colspan="3">
                <center>
                    <input id="fetchAllEvents" type="submit" style="width:150px" value="FETCH EVENTS">
            
                    <input id="purgeAllEvents" type="submit" style="width:150px" value="PURGE EVENTS">

                    <input id="purgeAllSchedules" type="submit" style="width:150px" value="PURGE SCHEDULES">
                </center>
            </td>
        </tr>
    </table>
    <div>
        <ul id="output">

        </ul>
    </div>
    <script>
    var eventObj;
    $('#fetchAllEvents').click(function () {

        $.getJSON('fetchAllEvents', function (data) {

            $("ul#output > li").remove();

            $.each(data, function (key, value) {
                $("#output").append('<li>' + value['eventName'] + " " + value['startDate'] + '</li>');
            });
        });
    });

    $('#saveSingleEvent').click(function () {

        eventObj = {
            "eventName":document.getElementById('eventName').value,
            "startDate":document.getElementById('startDate').value,
            "endDate":document.getElementById('endDate').value,
            "recurNum":document.getElementById('recurNum').value,
            "recurPattern":document.getElementById('recurPattern').value,
            "weekPattern":fnTypePattern(document.getElementById('weekPattern')),
            "monthPattern":document.getElementById('monthPattern').value,
            "recurFreq":document.getElementById('recurFreq').value};

        if(!stompConnected) {
            fnConnect();
        }
        fnSubmit(eventObj);
        $("ul#output > li").remove();

        $("#output").append('<li>Saved</li>');
    });

    $('#saveMultipleEvent').click(function () {
        
        var lines = document.getElementById('multiEvents').value.split('\n');
        
        for(var i = 0;i < lines.length;i++){

            if(""!=lines[i]) {
                fnSubmit(JSON.parse(lines[i]));
            }
        }
        $("ul#output > li").remove();

        $("#output").append('<li>Saved</li>');
    });

    $('#purgeAllEvents').click(function () {

        $.getJSON('purgeAllEvents', function (data) {
        });

        $("ul#output > li").remove();

        $("#output").append('<li>Purged events</li>');
    });

    $('#purgeAllSchedules').click(function () {

        $.getJSON('purgeAllSchedules', function (data) {
        });

        $("ul#output > li").remove();

        $("#output").append('<li>Purged schedules</li>');
    });
    </script>
    </center>
</body>
</html>